FROM ubuntu:18.04

RUN apt-get update && apt-get install --yes unzip wget

ARG TERRAFORM_VERSION
RUN wget https://releases.hashicorp.com/terraform/${TERRAFORM_VERSION}/terraform_${TERRAFORM_VERSION}_linux_386.zip
RUN unzip terraform_${TERRAFORM_VERSION}_linux_386.zip
RUN mv terraform /usr/local/bin/
RUN rm terraform_${TERRAFORM_VERSION}_linux_386.zip

WORKDIR /app
COPY entrypoint.sh *.tf ./

ENV TF_VAR_APP_VERSION ${TF_VAR_APP_VERSION}
ENV TF_VAR_AWS_PROFILE ${TF_VAR_AWS_PROFILE}
ENV TF_VAR_AWS_REGION ${TF_VAR_AWS_REGION}
ENV TF_VAR_DATABASE_ENGINE ${TF_VAR_DATABASE_ENGINE}
ENV TF_VAR_DATABASE_ENGINE_VERSION ${TF_VAR_DATABASE_ENGINE_VERSION}
ENV TF_VAR_DATABASE_PASSWORD ${TF_VAR_DATABASE_PASSWORD}
ENV TF_VAR_DATABASE_PORT ${TF_VAR_DATABASE_PORT}
ENV TF_VAR_DATABASE_USERNAME ${TF_VAR_DATABASE_USERNAME}
ENV TF_VAR_PROJECT_NAME ${TF_VAR_PROJECT_NAME}

CMD [ "bash", "entrypoint.sh" ]
